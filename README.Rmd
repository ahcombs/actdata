---
output: github_document
always_allow_html: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

```{r setup}
library(dplyr)
library(actdata)
```


# actdata

<!-- badges: start -->
<!-- badges: end -->

This package is intended to be a repository for standardized versions of all publicly released affect control theory dictionaries and equations, which span nearly 45 years and multiple cultures around the world. These datasets can be used by affect control theorists to understand the cultural meaning of objects and events, as well as how these meanings vary across time and place. Within affect control theory, a social psychological theory of cultural meaning and interaction, words describing identities and behaviors have meanings on three dimensions of sentiment: evaluation (good vs bad), potency (powerful vs weak), and activity (active vs passive). Affect control theory dictionaries contain these evaluation, potency, and activity (EPA) values for a variety of terms. Equations describe how different terms work together to create meaning in the context of events. For more information about affect control theory, see [affectcontroltheory.org](http://affectcontroltheory.org/the-theory/overview/) and the many academic resources that it links to. 

Many affect control theory datasets have been publicly released by researchers, facilitating new research in the tradition. However, these datasets are stored in several different places and in several different formats. The actdata R package standardizes them and brings them together in one place in order to make them easier to access and make part of a reproducible analysis workflow. Details on standardization procedures for dictionaries and equation sets, instructions for how to access the data in this package, and a worked example using the Tidyverse to manipulate these datasets are provided below. 

## Installation

You can install the development version of actdata from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ahcombs/actdata")
```

## Dictionary Data

This package contains data from 24 different publicly available affect control theory dictionary datasets. Metadata for these datasets is shown in the table below. More detail on each of the columns is included below the table.

```{r dict key table, echo = FALSE}
dict_table <- actdata:::read_metadata("dict") %>% 
  dplyr::select(-filetype) %>% 
  dplyr::select(key, context, year, types, components, genders, description, citation, notes, source)

names(dict_table) <- c("Dataset key", "Country or context", "Year", "Data types", "Components", "Genders", "Description", "Citation", "Notes", "Source")

dict_table %>% 
  kableExtra::kable() %>% 
  kableExtra::kable_styling()
```

* *Dataset key*: an identifier unique to a particular study (e.g. `nc1978`; `morocco2015`). These keys are used within this package's functions to access particular datasets.
* *Country or context*: The country (or other context, such as the Internet) where the data was originally collected. 
* *Year*: The year of data collection. In some cases these are approximate; always check original sources for definitive information.
* *Data types*: This column indicates what types of summary data are available in a dictionary. Most older dictionaries (pre-2015) provide term EPA values only as `mean` values. For some more recent datasets, standard deviation (`sd`) and covariance (`cov`) information is also available. This column also indicates whether `individual`-level data is available in addition to summary statistics. Most research in the affect control theory tradition has utilized just mean values, but some recent work (e.g., [Rogers 2019](https://doi.org/10.1177/2329496518805688)) and BayesACT ([Schr√∂der, Hoey, and Rogers 2016](https://doi.org/10.1177/0003122416650963)), a recent Bayesian extension of the theory, have used variance information and individual-level responses to investigate topics like demographic patterning in meaning and the effects of meaning uncertainty.
* *Component*: indicates what kind of terms are included in the dictionary dataset. Typically, studies provide dictionary datasets with more than one component, but not all studies provide all possible components. Components include: 
    * *identity:* Words that describe actors. Typically nouns (e.g. academic, woman, youngster)
    * *behavior:* Actions that actors can perform. Typically verbs (e.g. wheedle, acclaim, work)
    * *modifier:* Typically adjectives that can be applied to identities (e.g. active, witty, young)
    * *setting:* Places and situations (e.g. airplane, alley, worship_service)
* *Genders*: indicates available gender subsets. Options are `male`, `female`, and `average`. "Average" indicates that participants of all genders were included, though the way this is calculated differs slightly by dictionary. Some dictionaries (e.g. the 2015 US, Morocco, and Egypt dictionaries) are originally published as average values over raters of all genders. In these cases, `average` is the only provided option. Other dictionaries are originally published in male and female subsets. Average values over all raters are not provided in these originally published sets. In this case, the package calculates an approximate average by averaging the male and female values. Typically, studies recruit approximately equal numbers of men and women and men and women's ratings do not differ substantially on most terms, so we expect these approximate average values to be reasonably close to those that we would obtain from an average over all raters. For these dictionaries that provide male and female subsets separately, the package provides male, female, and approximate average versions. For more information on gender and affect control theory dictionaries, see section 4.1 of David Heise's *Expressive Order* (2007). 
* *Description*: Any summary information provided in the original source.
* *Citation*: Citation information for the original source, as provided by that source (if any).
* *Source*: Where the raw data for the package was downloaded or otherwise obtained from. These sources are for mean values; all individual data, none of which has previously been made publicly available, was obtained through personal communications. 


Within R, this same metadata information can be printed to the console using dict_info(). 

```{r}
library(actdata)
dict_info("nc1978")
dict_info("politics2003")
```

### Accessing dictionary data: summary statistics

Within the package, all summary data is stored in one data frame named `epa_summary_statistics`. This dataframe contains all available EPA means and variances, covariances, and respondent numbers (when available) for all terms in all dictionaries. 

Researchers will rarely need or want to work with all of these data at one time. To easily build subsets of this dataframe, use the `epa_subset()` function. This function allows users to search by term, filter by dataset, return only certain summary statistics, and more. Both the original dataframe and these subsets are provided in long form, making them easy to manipulate further using the Tidyverse if needed. 

```{r subset examples}
# Return all gender-average entries for terms containing "friend"
contains_friend <- epa_subset(expr = "friend", gender = "average")
head(contains_friend)

# Return all entries for the identity "friend"
friend <- epa_subset(expr = "^friend$", component = "identity")
head(friend)

# Return the entire Ontario 1980 dataset
all_ontario1980 <- epa_subset(dataset = "ontario1980")
head(all_ontario1980)

# Return this same dataset, but only include the female mean values for behaviors
f_mean_ontario1980 <- epa_subset(dataset = "ontario1980", gender = "female", component = "behavior", stat = "mean")
head(f_mean_ontario1980)
```


### Accessing dictionary data: individual-level data

Eight datasets, all from around 2015, include individual-level data. Some of these are subsets of others. These are the following (see the dictionary table above or use `dict_info()` for more information):

1. morocco2015
2. egypt2015
3. usmturk2015
4. dukestudent2015
5. uga2015
6. dukecommunity2015
7. usstudent2015 (a combination of 4 and 5)
8. usfullsurveyor2015 (a combination of 4, 5, and 6)

Access these data by calling the desired set using the format `[key]_individual`. These datasets contain different sets of respondent-level covariates. For summary information, use `?` preceding a dataset name--for example, enter `?dukecommunity_individual` to see documentation for the Duke community dataset. 

Like the summary datasets, these datasets are provided in long form, with one respondent's ratings of one term per row. 

```{r individual}
head(usfullsurveyor2015_individual)
```

### Term table

One of the main goals of this package is to make it easy to compare across dictionaries. To this end, the package provides a dataframe called `term_table` that shows at a glance which terms are included in which dictionaries. Each column in these tables represents a dictionary (labeled with its key) and each row is a term. Cell entries (0/1) indicate whether or not the specified dictionary has the specified term. These tables can easily be modified further to generate summaries across a set of dictionaries of interest. To see the entries for only a particular component, to search by term, or to limit to a particular set of dictionaries, I recommend using simple Tidyverse functions to filter the term table. 

```{r term table}
# the whole table
head(term_table)

# settings only
term_table %>% 
  dplyr::filter(component == "setting")

# limit to only the two Germany dictionaries and exclude terms in neither
term_table %>% 
  dplyr::select(term, component, germany1989, germany2007) %>% 
  dplyr::filter(germany1989 + germany2007 >= 1)

# limit to terms that contain "friend"
term_table %>% 
  dplyr::filter(stringr::str_detect(term, "friend"))
```

### Standardization and other processing of raw dictionary data

To facilitate comparisons between dictionaries, the terms in all have been transformed into a common format. All terms are provided in all-lowercase and spelling and spacing have been made standard across dictionaries (generally, the US spellings are chosen). Spaces are represented by underscores in all dictionaries. Accents and other punctuation have been removed. For transparency, the code used to perform this standardization is included in `R/raw_data_processing.R`.

Where individual data is available, the mean, standard deviation, and covariance values that are reported in the summary data have been calculated directly from the individual data within this package. The script used for this is in `data-raw/dicts.R`, which calls functions included in `R/raw_data_processing.R`

## Equations

The second kind of data this package makes available are tables containing estimates of affect control theory equation coefficients. These coefficients can be used in conjunction with dictionaries to calculate affective responses to various situations. See section 18.2 of David Heise's *Expressive Order* (2007) for a detailed description of the structure and use of these tables.

To see information on all equation sets available in this package, call `eqn_info()`. All of the available equation sets were originally sourced from Interact (version 2.1 beta, accessed May 2021), and component titles are based on labels applied in Interact.

### Naming convention

Because equations contain varying numbers of coefficients, they are stored in the package as separate data frames rather than combined into one as the dictionaries are. The equation datasets are named according to the following convention:

`[key]\_[component]\_[gender]\_eqn`

* *Key* is a unique identifier for the study in which the equation coefficients were estimated. Some of these overlap with dictionary keys, but not all. All keys can be accessed using `eqn_info()`.
* *Component* indicates the type of equations represented. The following components are possible (more information on each is available in section 18.2 of David Heise's *Expressive Order* (2007)). 
    * *impressionabo:* Impression change equations including actor, behavior, and object terms
    * *impressionabos:* Impression change equations including actor, behavior, object, and setting terms
    * *selfdir:* Equations for self-directed action, including actor and behavior terms.
    * *traitid:* Equations for combining a trait modifier with an identity. In some datasets, this set is the same as the emotionid set.
    * *emotionid:* Equations for combining an emotion modifier with an identity. In some datasets, this set is the same as the traitid set.
* *Gender* indicates the gender of study participants whose ratings are used to estimate the equation coefficients. Options are `m`, `f`, and `av`. Call `eqn_info()` (optionally, with a specific equation key as an argument) to check which components are specified for which genders. Unlike with dictionary files, where all components within a dictionary are available for the same set of genders, the available genders for equation sets vary by component. Interact, from which all of these equation sets were originally taken, provides male and female-labeled sets for each equation. However, sometimes these sets are identical. In this case, this package simply labels the component of the set as `av` rather than including it twice. All values are provided exactly as they are in Interact--no post-hoc calculations have been performed.

```{r}
eqn_info("us2010")
```

## Writing files for Interact

Interact allows users to import their own dictionary and equation files. Though many of the dictionaries and equation sets provided here are available in Interact, several are not. Additionally, sometimes it is useful to use subsets of dictionaries (e.g. when a user wants to restrict the identities, behaviors, or modifiers available), and creating these subsets within Interact itself, while possible, is tedious and not easily replicable.

The `save_for_interact()` function in this package makes it easy to write dictionary and equation .txt files that are correctly formatted for copying and pasting into Interact. The `data` argument should be a dataframe that the user wishes to save (it can be one of those provided, or one created by the user). `type` should be either `dict` or `eqn` (by default, it is set to `dict`). `filename` should be the filepath at which the user wishes to save the file (by default, it saves to the working directory under the name of the dataset). All filepaths must end in .txt. 

Note that at this time, Interact does not accept institution codes, and so these will be removed from dictionary files before saving. 
