---
title: "Dictionaries"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Dictionaries}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = FALSE}
library(actdata)
library(dplyr)
```

# EPA dictionaries

actdata makes available a number of what are known as EPA dictionaries. These dictionaries provide the measured evaluation, potency, and activity values associated with terms. 

This package contains data from 26 different publicly available affect control theory dictionary datasets. Metadata for these datasets is shown in the table below. More detail on each of the columns is included below the table. 

Within R, this meta information plus descriptions and citations from the sources can be accessed using `dict_info()`. Leaving the argument blank will print information for all data sets. Pass the function a data set key to see metadata for just that data set. 

```{r dict key table, echo = FALSE}
dict_table <- actdata:::get_meta("dict") %>% 
  dplyr::select(-filetype) %>% 
  dplyr::select(key, context, year, stats, components, genders, individual, information, notes) %>% 
  mutate(linkname = "Webpage")

dict_table$information <- kableExtra::cell_spec(dict_table$linkname, format = "html", link = dict_table$information)

dict_table <- dplyr::select(dict_table, -linkname)

names(dict_table) <- c("Dataset key", "Country or context", "Year", "Statistics available", "Components", "Genders", "Individual data available", "More information", "Notes")

dict_table %>% 
  kableExtra::kable(escape = FALSE) %>% 
  kableExtra::kable_styling()
```

* *Dataset key*: an identifier unique to a particular study (e.g. `nc1978`; `morocco2015`). These keys are used within this package's functions to access particular datasets.
* *Country or context*: The country (or other context, such as the internet) where the data was originally collected. 
* *Year*: The year of data collection. In some cases these are approximate; always check original sources for definitive information.
* *Data types*: This column indicates what types of summary data are available in a dictionary. Most older dictionaries (pre-2015) provide term EPA values only as `mean` values. For some more recent datasets, standard deviation (`sd`) and covariance (`cov`) information is also available. Most research in the affect control theory tradition has utilized just mean values, but some recent work (e.g., [Rogers 2019](https://doi.org/10.1177/2329496518805688)) and BayesACT ([Schr√∂der, Hoey, and Rogers 2016](https://doi.org/10.1177/0003122416650963)), a recent Bayesian extension of the theory, have used variance information and individual-level responses to investigate topics like demographic patterning in meaning and the effects of meaning uncertainty.
* *Component*: indicates what kind of terms are included in the dictionary dataset. Typically, studies provide dictionary datasets with more than one component, but not all studies provide all possible components. Components include: 
    * *identity:* Words that describe actors. Typically nouns (e.g. academic, woman, youngster)
    * *behavior:* Actions that actors can perform. Typically verbs (e.g. wheedle, acclaim, work)
    * *modifier:* Typically adjectives that can be applied to identities (e.g. active, witty, young)
    * *setting:* Places and situations (e.g. airplane, alley, worship_service)
* *Genders*: indicates available gender subsets. Options are `male`, `female`, and `average`. "Average" indicates that participants of all genders were included, though the way this is calculated differs slightly by dictionary. Some dictionaries (e.g. the 2015 US, Morocco, and Egypt dictionaries) are originally published as average values over raters of all genders. In these cases, `average` is the only provided option. Other dictionaries are originally published in male and female subsets. Average values over all raters are not provided in these originally published sets. In this case, the package calculates an approximate average by averaging the male and female values. Typically, studies recruit approximately equal numbers of men and women and men and women's ratings do not differ substantially on most terms, so we expect these approximate average values to be reasonably close to those that we would obtain from an average over all raters. For these dictionaries that provide male and female subsets separately, the package provides male, female, and approximate average versions. For more information on gender and affect control theory dictionaries, see section 4.1 of David Heise's *Expressive Order* (2007). 
* *Individual data available*: All data sets contain summary information. For some recent data sets, the respondent-level data used to generate summary statistics is available as well.

```{r}
dict_info("nc1978")
dict_info("politics2003")
```

## Accessing dictionary data: summary statistics

Within the package, all summary data is stored in one data frame named `epa_summary_statistics`. This data frame contains all available EPA means and, when available, institution codes, variances, covariances, and respondent numbers for all terms in all dictionaries. There is one row per term-dataset-gender group. 

These data are identical to (and usually sourced directly from) that provided in other places, such as [affectcontroltheory.org](http://affectcontroltheory.org/resources-for-researchers/data-sets-for-simulation/), Interact Java, and a legacy [affect control theory](https://cs.uwaterloo.ca/~jhoey/research/ACTBackup/ACT/data.html) [website](https://cs.uwaterloo.ca/~jhoey/research/ACTBackup/ACT/interact/importable_data.htm). 

Researchers will rarely need or want to work with all of these data at one time. To easily build subsets of this data frame, use the `epa_subset()` function. This function allows users to search by term, filter by dataset, return only certain summary statistics, and more. Both the original data frame and these subsets are provided in long form, making them easy to manipulate further using the Tidyverse if needed. 

The columns in this data set correspond to those in the dictionary metadata table above. However, to aid sorting, only one year (instead of a range) is provided for all data sets. 

```{r subset examples}
# Return all gender-average entries for terms containing "friend"
contains_friend <- epa_subset(expr = "friend", gender = "average")
head(contains_friend)

# Return all entries for the identity "friend"
friend <- epa_subset(expr = "friend", exactmatch = TRUE, component = "identity")
head(friend)

# Return the entire Ontario 1980 dataset
all_ontario1980 <- epa_subset(dataset = "ontario1980")
head(all_ontario1980)

# Return this same dataset, but only include the female mean values for behaviors
f_mean_ontario1980 <- epa_subset(dataset = "ontario1980", gender = "female", component = "behavior", stat = "mean")
head(f_mean_ontario1980)
```


## Accessing dictionary data: individual-level data

EPA summary information is likely to be sufficient for most research questions. Existing research in affect control theory almost always uses summary data. However, the respondent-level data used to compute these summaries may also be useful in particular instances. 

Ten data sets, all from 2015 or later, include individual-level data, newly made publicly available in this package. Some of these are subsets of others. These are the following (see the dictionary table above or call `dict_info()` for more information):

1. morocco2015
2. egypt2015
3. usmturk2015
4. dukestudent2015
5. uga2015
6. dukecommunity2015
7. usstudent2015 (a combination of 4 and 5)
8. usfullsurveyor2015 (a combination of 4, 5, and 6)
9. occs2019
10. occs2020

All individual data is located in the `individual` data frame within this package. Like the summary datasets, these data are provided in long form, with one respondent's ratings of one term per row. Where available, respondents' gender, race, and age are also included.

To subset these data, use the `epa_subset()` function with the datatype argument set to "individual." 

When using any of the US 2015 individual level data sets, keep in mind that usstudent2015 and usfullsurveyor2015 are combinations of other datasets. In the individual data, rows belonging to these sets are included, but are categorized as belonging to the more specific data set (dukestudent2015, uga2015, or dukecommunity2015). You may still use the usstudent2015 and usfullsurveyor2015 keys in `epa_subset()` with `datatype = individual`. The function will return rows from the appropriate combination of data sets.

```{r subset individual data}
# Return all individual-level ratings for identities from the egypt2015 data set
egypt_individual <- epa_subset(dataset = "egypt2015", datatype = "individual", component = "identity")
head(egypt_individual)

# Return all ratings by female-identifying students in the usstudent2015 data set
female_students <- epa_subset(dataset = "usstudent2015", datatype = "individual") %>% 
  dplyr::filter(gender == "Female")
head(female_students)
```

## Term table

One of the main goals of this package is to make it easy to compare meaning across dictionaries. To this end, the package provides a data frame called `term_table` that shows at a glance which terms are included in which dictionaries. Each column in these tables represents a dictionary (labeled with its key) and each row is a term. Cell entries (0/1) indicate whether or not the specified dictionary has the specified term. These tables can easily be modified further to generate summaries across a set of dictionaries of interest. To see the entries for only a particular component, to search by term, or to limit to a particular set of dictionaries, use dplyr functions to filter the term table. 

```{r term table}
# the whole table
head(term_table)

# settings only
set_tt <- term_table %>% 
  dplyr::filter(component == "setting")
head(set_tt)

# limit to only the two Germany dictionaries and exclude terms in neither
german_tt <- term_table %>% 
  dplyr::select(term, component, germany1989, germany2007) %>% 
  dplyr::filter(germany1989 + germany2007 >= 1)
head(german_tt)

# limit to terms that contain "friend"
friend_tt <- term_table %>% 
  dplyr::filter(stringr::str_detect(term, "friend"))
head(friend_tt)
```

## Institution codes

Contexts restrict the labels that we consider reasonable choices. For instance, if two people are discussing next year's budget in a business meeting, it would seem quite unlikely for one to label the other as a "priest". A business-related label, like "manager" or "employee", or a label that applies across a variety of contexts, like "genius" or "jerk", would seem more realistic. 

EPA dictionaries usually contain 14-digit binary strings known as "institution codes" that contain information about what social contexts terms apply within. These codes can be used by analysis software when simulating interaction. 

Valid categories are (see Heise's 2007 book *Expressive Order* for details): 
  * male, female: What genders terms can typically be applied to (identities only)
  * overt, surmised: Whether labeling behaviors requires interpretation or insight on the part of the observer (behaviors only)
  * place, time: Type of setting (settings only)
  * lay, business, law, politics, academe, medicine, religion, family, sexual: Social institutions that terms may belong to. Institutions, behaviors, and settings only.
  * monadic, group, corporal: How a term requires or implicates others. Identities, behaviors, and settings only.
  * adjective, adverb: Part of speech (modifiers)
  * emotion, trait, status, feature, emotion_spiral: Categories for modifiers.

This package provides several ways to demystify and make use of these codes. See the function documentation for more details. 
  * The `epa_subset()` function takes an `institutions` argument that allows a user to filter by institution. 
  * The `expand_instcodes()` function converts institution code strings into columns containing TRUE/FALSE/NA values. These values indicate whether a category is applicable to a term and, if so, whether the term belongs to the category. Representing institutions in this way makes it easier for users to work with them. 
  * The `create_instcode()` function takes a component and a set of logical values indicating category membership and returns a properly formatted institution code binary string. This is useful for creating new institution codes.

```{r institution codes}
businesslaw <- epa_subset(dataset = "morocco2015", institutions = c("business", "law"), stat = "mean") %>% 
  dplyr::select(term, component, instcodes, E, P, A)
head(businesslaw)

# the default is to keep terms for which there are no institution codes. 
# Change this behavior using the drop.na.instcodes argument in epa_subset().
businesslaw <- expand_instcodes(businesslaw) %>% 
  dplyr::select(-E, -P, -A)
head(businesslaw, 7)

newcode <- create_instcode(component = "setting", place = TRUE, family = TRUE, religion = TRUE)
print(paste("The institution code", newcode, "represents a setting that is a place and is relevant to only the family and religion domains."))
```

